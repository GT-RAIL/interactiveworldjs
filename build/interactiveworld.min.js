var INTERACTIVEWORLD=INTERACTIVEWORLD||{REVISION:"1-devel"};INTERACTIVEWORLD.Z_INDEX=.005,INTERACTIVEWORLD.NORTH_WALL=0,INTERACTIVEWORLD.EAST_WALL=1,INTERACTIVEWORLD.SOUTH_WALL=2,INTERACTIVEWORLD.WEST_WALL=3,INTERACTIVEWORLD.NEGATIVE_DOOR_SIDE=0,INTERACTIVEWORLD.POSITIVE_DOOR_SIDE=1,INTERACTIVEWORLD.WALL_WIDTH=.05,INTERACTIVEWORLD.WALL_HEIGHT=1.5,INTERACTIVEWORLD.DOOR_WIDTH=.8,INTERACTIVEWORLD.WORLD_WIDTH=100,INTERACTIVEWORLD.WORLD_HEIGHT=100,INTERACTIVEWORLD.WORLD_FLOOR_TEXTURE="grass.jpg",INTERACTIVEWORLD.HOUSE_WIDTH=10,INTERACTIVEWORLD.HOUSE_HEIGHT=8,INTERACTIVEWORLD.HOUSE_WALL_TEXTURE="wall.jpg",INTERACTIVEWORLD.HOUSE_FLOOR_TEXTURE="floor.jpg",INTERACTIVEWORLD.BEDROOM_WIDTH=4.9,INTERACTIVEWORLD.BEDROOM_HEIGHT=4.5,INTERACTIVEWORLD.BEDROOM_WALL_TEXTURE="bedroom.jpg",INTERACTIVEWORLD.BEDROOM_FLOOR_TEXTURE="carpet.jpg",INTERACTIVEWORLD.BED_MODEL="bed.dae",INTERACTIVEWORLD.DRESSER_MODEL="dresser.dae",INTERACTIVEWORLD.Bed=function(){var a=this;THREE.Object3D.call(this);var b=new THREE.ColladaLoader;b.load(INTERACTIVEWORLD.BED_MODEL,function(b){a.add(b.scene)})},INTERACTIVEWORLD.Bed.prototype.__proto__=THREE.Object3D.prototype,INTERACTIVEWORLD.Dresser=function(){var a=this;THREE.Object3D.call(this);var b=new THREE.ColladaLoader;b.load(INTERACTIVEWORLD.DRESSER_MODEL,function(b){b.scene.position.x-=18,b.scene.position.y-=12,a.add(b.scene)})},INTERACTIVEWORLD.Dresser.prototype.__proto__=THREE.Object3D.prototype,INTERACTIVEWORLD.TexturePlane=function(a){a=a||{};var b=a.width,c=a.height,d=a.texture,e=a.repeat,f=new THREE.ImageUtils.loadTexture(d);f.wrapS=f.wrapT=THREE.RepeatWrapping,f.repeat.set(e,e),THREE.Mesh.call(this,new THREE.PlaneGeometry(b,c),new THREE.MeshLambertMaterial({map:f}))},INTERACTIVEWORLD.TexturePlane.prototype.__proto__=THREE.Mesh.prototype,INTERACTIVEWORLD.Wall=function(a){a=a||{};var b=a.length,c=a.texture,d=new THREE.ImageUtils.loadTexture(c);d.wrapS=d.wrapT=THREE.RepeatWrapping,d.repeat.set(b,1),THREE.Mesh.call(this,new THREE.CubeGeometry(b,INTERACTIVEWORLD.WALL_WIDTH,INTERACTIVEWORLD.WALL_HEIGHT),new THREE.MeshLambertMaterial({map:d,side:THREE.DoubleSide})),this.position.z=INTERACTIVEWORLD.WALL_HEIGHT/2},INTERACTIVEWORLD.Wall.prototype.__proto__=THREE.Mesh.prototype,INTERACTIVEWORLD.Bedroom=function(){THREE.Object3D.call(this),this.add(new INTERACTIVEWORLD.Room({width:INTERACTIVEWORLD.BEDROOM_WIDTH,height:INTERACTIVEWORLD.BEDROOM_HEIGHT,floor:INTERACTIVEWORLD.BEDROOM_FLOOR_TEXTURE,wall:INTERACTIVEWORLD.BEDROOM_WALL_TEXTURE,withDoor:!0,doorWall:INTERACTIVEWORLD.WEST_WALL,doorSide:INTERACTIVEWORLD.NEGATIVE_DOOR_SIDE}));var a=new INTERACTIVEWORLD.Bed;this.add(a);var b=new INTERACTIVEWORLD.Dresser;b.position.x=INTERACTIVEWORLD.BEDROOM_WIDTH/2-.8,b.position.y=INTERACTIVEWORLD.BEDROOM_HEIGHT/2-INTERACTIVEWORLD.WALL_WIDTH,this.add(b),this.add(new THREE.DirectionalLight(16777215,.9))},INTERACTIVEWORLD.Bedroom.prototype.__proto__=THREE.Object3D.prototype,INTERACTIVEWORLD.House=function(){THREE.Object3D.call(this);var a=new INTERACTIVEWORLD.Room({width:INTERACTIVEWORLD.HOUSE_WIDTH,height:INTERACTIVEWORLD.HOUSE_WIDTH,floor:INTERACTIVEWORLD.HOUSE_FLOOR_TEXTURE,wall:INTERACTIVEWORLD.HOUSE_WALL_TEXTURE});a.position.z=-INTERACTIVEWORLD.Z_INDEX,this.add(a);var b=new INTERACTIVEWORLD.Bedroom;this.add(b)},INTERACTIVEWORLD.House.prototype.__proto__=THREE.Object3D.prototype,INTERACTIVEWORLD.Room=function(a){THREE.Object3D.call(this),a=a||{};var b=a.width,c=a.width,d=a.withDoor,e=a.doorWall,f=a.doorSide,g=a.floor,h=a.wall;this.add(new INTERACTIVEWORLD.TexturePlane({width:b,height:c,texture:g,repeat:5}));var i=new INTERACTIVEWORLD.Wall({length:b,texture:h});i.position.y=c/2;var j=new INTERACTIVEWORLD.Wall({length:c,texture:h});j.position.x=b/2,j.rotation.z=Math.PI/2;var k=new INTERACTIVEWORLD.Wall({length:b,texture:h});k.position.y=-c/2;var l=new INTERACTIVEWORLD.Wall({length:c,texture:h});l.position.x=-b/2,l.rotation.z=Math.PI/2,d&&(e===INTERACTIVEWORLD.NORTH_WALL?(i=new INTERACTIVEWORLD.Wall({length:b-INTERACTIVEWORLD.DOOR_WIDTH,texture:h}),i.position.y=c/2,i.position.x=f===INTERACTIVEWORLD.NEGATIVE_DOOR_SIDE?INTERACTIVEWORLD.DOOR_WIDTH/2:-INTERACTIVEWORLD.DOOR_WIDTH/2):e===INTERACTIVEWORLD.EAST_WALL?(j=new INTERACTIVEWORLD.Wall({length:c-INTERACTIVEWORLD.DOOR_WIDTH,texture:h}),j.position.x=b/2,j.rotation.z=Math.PI/2,j.position.y=f===INTERACTIVEWORLD.NEGATIVE_DOOR_SIDE?INTERACTIVEWORLD.DOOR_WIDTH/2:-INTERACTIVEWORLD.DOOR_WIDTH/2):e===INTERACTIVEWORLD.SOUTH_WALL?(k=new INTERACTIVEWORLD.Wall({length:b-INTERACTIVEWORLD.DOOR_WIDTH,texture:h}),k.position.y=-c/2,k.position.x=f===INTERACTIVEWORLD.NEGATIVE_DOOR_SIDE?INTERACTIVEWORLD.DOOR_WIDTH/2:-INTERACTIVEWORLD.DOOR_WIDTH/2):(l=new INTERACTIVEWORLD.Wall({length:c-INTERACTIVEWORLD.DOOR_WIDTH,texture:h}),l.position.x=-b/2,l.rotation.z=Math.PI/2,l.position.y=f===INTERACTIVEWORLD.NEGATIVE_DOOR_SIDE?INTERACTIVEWORLD.DOOR_WIDTH/2:-INTERACTIVEWORLD.DOOR_WIDTH/2)),this.add(i),this.add(j),this.add(k),this.add(l)},INTERACTIVEWORLD.Room.prototype.__proto__=THREE.Object3D.prototype,INTERACTIVEWORLD.MouseControls=function(a){function b(a){switch(a.preventDefault(),a.button){case 0:o=n.PAN,l.set(a.clientX,a.clientY);break;case 2:o=n.ROTATE,k.set(a.clientX,a.clientY)}g.domElement.addEventListener("mousemove",c,!1),g.domElement.addEventListener("mouseup",d,!1)}function c(a){a.preventDefault();var b=a.movementX||a.mozMovementX||a.webkitMovementX||0,c=a.movementY||a.mozMovementY||a.webkitMovementY||0;switch(o){case n.ROTATE:j.position.x=i.position.x,j.position.y=i.position.y,j.rotation.z-=.002*(b-c);break;case n.PAN:i.translateX(.01*-b),i.translateY(.01*c)}}function d(a){a.preventDefault(),g.domElement.removeEventListener("mousemove",c,!1),g.domElement.removeEventListener("mouseup",d,!1),o=n.NONE}function e(a){a.preventDefault();var b=0;a.wheelDelta?b=a.wheelDelta:a.detail&&(b=-a.detail),b>0?g.dollyOut():g.dollyIn()}function f(a){a.preventDefault();var b=new THREE.Vector3(2*(a.clientX/window.innerWidth)-1,2*-(a.clientY/window.innerHeight)+1,.5);m.unprojectVector(b,g.camera),g.camera.updateMatrixWorld();var c=new THREE.Vector3;c.getPositionFromMatrix(g.camera.matrixWorld);var d=new THREE.Raycaster(c,b.sub(c).normalize()),e=d.intersectObjects(h);e.length>0&&(e[0].object.material.color.setHex(16777215*Math.random()),console.log("hit"))}var g=this;a=a||{},this.camera=a.camera,this.scene=a.scene,this.domElement=a.domElement;var h=a.objects,i=new THREE.Object3D;i.add(this.camera);var j=i;this.scene.add(j),this.target=new THREE.Vector3,this.EPS=1e-6,this.phiDelta=0,this.thetaDelta=0,this.scale=1,this.pan=new THREE.Vector3,this.zoomSpeed=1,this.autoRotateSpeed=2;var k=new THREE.Vector2,l=new THREE.Vector2;this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minDistance=0,this.maxDistance=1/0,this.lastPosition=new THREE.Vector3;var m=new THREE.Projector,n={NONE:-1,ROTATE:0,DOLLY:1,PAN:2},o=n.NONE;this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1),this.domElement.addEventListener("mousedown",b,!1),this.domElement.addEventListener("mousewheel",e,!1),this.domElement.addEventListener("DOMMouseScroll",e,!1),this.domElement.addEventListener("mousemove",f,!1),this.rotateUp(-.75)},INTERACTIVEWORLD.MouseControls.prototype.__proto__=THREE.EventDispatcher.prototype,INTERACTIVEWORLD.MouseControls.prototype.update=function(){var a=this.camera.position,b=a.clone().sub(this.target),c=Math.atan2(Math.sqrt(b.x*b.x+b.z*b.z),b.y)+this.phiDelta;c=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,c)),c=Math.max(this.EPS,Math.min(Math.PI-this.EPS,c));var d=b.length()*this.scale;d=Math.max(this.minDistance,Math.min(this.maxDistance,d)),b.y=d*Math.cos(c),b.z=d*Math.sin(c),a.copy(this.target).add(b),this.camera.lookAt(this.target),this.phiDelta=0,this.scale=1},INTERACTIVEWORLD.MouseControls.prototype.rotateUp=function(a){void 0===a&&(a=2*Math.PI/60/60*this.autoRotateSpeed),this.phiDelta-=a},INTERACTIVEWORLD.MouseControls.prototype.dollyIn=function(a){void 0===a&&(a=Math.pow(.95,this.zoomSpeed)),this.scale/=a,this.rotateUp(.01)},INTERACTIVEWORLD.MouseControls.prototype.dollyOut=function(a){void 0===a&&(a=Math.pow(.95,this.zoomSpeed)),this.scale*=a,this.rotateUp(-.01)},INTERACTIVEWORLD.Viewer=function(a){function b(){j.update(),i.position=h.localToWorld(new THREE.Vector3(-1,1,0)),i.position.normalize(),f.render(g,h),requestAnimationFrame(b)}var c=[];a=a||{};var d=a.divID,e=a.antialias,f=new THREE.WebGLRenderer({antialias:e});f.setSize(window.innerWidth,window.innerHeight);var g=new THREE.Scene,h=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,.01,1e3);h.position.z=4*INTERACTIVEWORLD.WALL_HEIGHT,g.add(new THREE.AmbientLight(6710886));var i=new THREE.DirectionalLight(16777215,.9);g.add(i),g.add(new INTERACTIVEWORLD.World);var j=new INTERACTIVEWORLD.MouseControls({scene:g,camera:h,domElement:f.domElement,objects:c});window.addEventListener("resize",function(){h.left=window.innerWidth/-2,h.right=window.innerWidth/2,h.top=window.innerHeight/2,h.bottom=window.innerHeight/-2,h.updateProjectionMatrix(),f.setSize(window.innerWidth,window.innerHeight)},!1),document.getElementById(d).appendChild(f.domElement),b()},INTERACTIVEWORLD.World=function(){THREE.Object3D.call(this);var a=new INTERACTIVEWORLD.TexturePlane({width:INTERACTIVEWORLD.WORLD_WIDTH,height:INTERACTIVEWORLD.WORLD_HEIGHT,texture:INTERACTIVEWORLD.WORLD_FLOOR_TEXTURE,repeat:6});a.position.z=2*-INTERACTIVEWORLD.Z_INDEX,this.add(a);var b=THREE.ImageUtils.loadTextureCube(["posx.jpg","negx.jpg","posy.jpg","negy.jpg","posz.jpg","negz.jpg"]);b.format=THREE.RGBFormat;var c=THREE.ShaderLib.cube;c.uniforms.tCube.value=b,this.add(new THREE.Mesh(new THREE.CubeGeometry(INTERACTIVEWORLD.WORLD_WIDTH,INTERACTIVEWORLD.WORLD_HEIGHT,Math.max(INTERACTIVEWORLD.WORLD_WIDTH,INTERACTIVEWORLD.WORLD_HEIGHT)),new THREE.ShaderMaterial({fragmentShader:c.fragmentShader,vertexShader:c.vertexShader,uniforms:c.uniforms,side:THREE.BackSide}))),this.add(new INTERACTIVEWORLD.House)},INTERACTIVEWORLD.World.prototype.__proto__=THREE.Object3D.prototype;