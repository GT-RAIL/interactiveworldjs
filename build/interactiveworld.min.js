var INTERACTIVEWORLD=INTERACTIVEWORLD||{REVISION:"0.5.0-SNAPSHOT"};INTERACTIVEWORLD.TASK_NONE=-1,INTERACTIVEWORLD.TASK_TABLE_SETTING=0,INTERACTIVEWORLD.TASK_MAGAZINE_PLACEMENT=1,INTERACTIVEWORLD.TASK_DIRTY_DISHES=2,INTERACTIVEWORLD.TASK_PUT_AWAY_GENERAL=3,INTERACTIVEWORLD.DOT_RADIUS=.04,INTERACTIVEWORLD.BRICKS_TEXTURE="resources/textures/bricks.jpg",INTERACTIVEWORLD.CARPET_GREY_TEXTURE="resources/textures/carpet-grey.jpg",INTERACTIVEWORLD.CARPET_TAN_TEXTURE="resources/textures/carpet-tan.jpg",INTERACTIVEWORLD.GRASS_TEXTURE="resources/textures/grass.jpg",INTERACTIVEWORLD.HARDWOOD_DARK_TEXTURE="resources/textures/hardwood-dark.jpg",INTERACTIVEWORLD.HARDWOOD_LIGHT_TEXTURE="resources/textures/hardwood-light.jpg",INTERACTIVEWORLD.PAINTED_WALL_BLUE_TEXTURE="resources/textures/painted-wall-blue.jpg",INTERACTIVEWORLD.PAINTED_WALL_RED_TEXTURE="resources/textures/painted-wall-red.jpg",INTERACTIVEWORLD.RUG_TEXTURE="resources/textures/rug.jpg",INTERACTIVEWORLD.SKY_TEXTURE="resources/textures/sky.jpg",INTERACTIVEWORLD.TILE_FLOOR_TEXTURE="resources/textures/tile-floor.jpg",INTERACTIVEWORLD.TILE_WALL_TEXTURE="resources/textures/tile-wall.jpg",INTERACTIVEWORLD.WALLPAPER_LIGHT_TEXTURE="resources/textures/wallpaper-light.jpg",INTERACTIVEWORLD.NEXT_ARROW="resources/images/next.png",INTERACTIVEWORLD.PREVIOUS_ARROW="resources/images/previous.png",INTERACTIVEWORLD.Z_INDEX=.005,INTERACTIVEWORLD.NORTH_WALL=0,INTERACTIVEWORLD.EAST_WALL=1,INTERACTIVEWORLD.SOUTH_WALL=2,INTERACTIVEWORLD.WEST_WALL=3,INTERACTIVEWORLD.NEGATIVE_DOOR_SIDE=0,INTERACTIVEWORLD.POSITIVE_DOOR_SIDE=1,INTERACTIVEWORLD.INTERACTION_SURFACE_THICKNESS=.005,INTERACTIVEWORLD.OBJECT_MENU_DISPLAY_WIDTH=3,INTERACTIVEWORLD.OBJECT_MENU_DISPLAY_HEIGHT=3,INTERACTIVEWORLD.OBJECT_MENU_DISPLAY_FLOOR_TEXTURE=INTERACTIVEWORLD.WOOD_MAHOGANY_POLISHED_TEXTURE,INTERACTIVEWORLD.WORLD_WIDTH=20,INTERACTIVEWORLD.WORLD_HEIGHT=20,INTERACTIVEWORLD.WORLD_FLOOR_TEXTURE=INTERACTIVEWORLD.GRASS_TEXTURE,INTERACTIVEWORLD.WALL_WIDTH=.05,INTERACTIVEWORLD.WALL_HEIGHT=.75,INTERACTIVEWORLD.DOOR_WIDTH=.8,INTERACTIVEWORLD.HALLWAY_WIDTH=1,INTERACTIVEWORLD.ROOM_WIDTH=4.9,INTERACTIVEWORLD.ROOM_HEIGHT=4,INTERACTIVEWORLD.HOUSE_WIDTH=2*INTERACTIVEWORLD.ROOM_WIDTH+INTERACTIVEWORLD.HALLWAY_WIDTH,INTERACTIVEWORLD.HOUSE_HEIGHT=2*INTERACTIVEWORLD.ROOM_HEIGHT+INTERACTIVEWORLD.HALLWAY_WIDTH,INTERACTIVEWORLD.HOUSE_WALL_TEXTURE=INTERACTIVEWORLD.BRICKS_TEXTURE,INTERACTIVEWORLD.HOUSE_FLOOR_TEXTURE=INTERACTIVEWORLD.HARDWOOD_LIGHT_TEXTURE,INTERACTIVEWORLD.BEDROOM_WALL_TEXTURE=INTERACTIVEWORLD.PAINTED_WALL_BLUE_TEXTURE,INTERACTIVEWORLD.BEDROOM_FLOOR_TEXTURE=INTERACTIVEWORLD.CARPET_GREY_TEXTURE,INTERACTIVEWORLD.KITCHEN_WALL_TEXTURE=INTERACTIVEWORLD.TILE_WALL_TEXTURE,INTERACTIVEWORLD.KITCHEN_FLOOR_TEXTURE=INTERACTIVEWORLD.TILE_FLOOR_TEXTURE,INTERACTIVEWORLD.DINING_ROOM_WALL_TEXTURE=INTERACTIVEWORLD.WALLPAPER_LIGHT_TEXTURE,INTERACTIVEWORLD.DINING_ROOM_FLOOR_TEXTURE=INTERACTIVEWORLD.HARDWOOD_DARK_TEXTURE,INTERACTIVEWORLD.LIVING_ROOM_WALL_TEXTURE=INTERACTIVEWORLD.PAINTED_WALL_RED_TEXTURE,INTERACTIVEWORLD.LIVING_ROOM_FLOOR_TEXTURE=INTERACTIVEWORLD.CARPET_TAN_TEXTURE,INTERACTIVEWORLD.BED_MODEL="rail_collada_models/meshes/bed.min.dae",INTERACTIVEWORLD.DRESSER_MODEL="rail_collada_models/meshes/dresser.min.dae",INTERACTIVEWORLD.NIGHTSTAND_MODEL="rail_collada_models/meshes/nightstand.min.dae",INTERACTIVEWORLD.DINING_TABLE_MODEL="rail_collada_models/meshes/dining-table.min.dae",INTERACTIVEWORLD.SINK_MODEL="rail_collada_models/meshes/sink.min.dae",INTERACTIVEWORLD.CABINET_MODEL="rail_collada_models/meshes/cabinet.min.dae",INTERACTIVEWORLD.REFRIGERATOR_MODEL="rail_collada_models/meshes/refrigerator.min.dae",INTERACTIVEWORLD.OVEN_MODEL="rail_collada_models/meshes/oven.min.dae",INTERACTIVEWORLD.COUNTER_MODEL="rail_collada_models/meshes/counter.min.dae",INTERACTIVEWORLD.COUCH_MODEL="rail_collada_models/meshes/large-couch.min.dae",INTERACTIVEWORLD.TV_MODEL="rail_collada_models/meshes/tv-set.min.dae",INTERACTIVEWORLD.COFFEE_TABLE_MODEL="rail_collada_models/meshes/coffee-table.min.dae",INTERACTIVEWORLD.PLATE_MODEL="rail_collada_models/meshes/plate.min.dae",INTERACTIVEWORLD.SPOON_MODEL="rail_collada_models/meshes/spoon.min.dae",INTERACTIVEWORLD.MAGAZINES_MODEL="rail_collada_models/meshes/magazines.min.dae",INTERACTIVEWORLD.CUP_MODEL="rail_collada_models/meshes/cup.min.dae",INTERACTIVEWORLD.FORK_MODEL="rail_collada_models/meshes/fork.min.dae",INTERACTIVEWORLD.CSS="resources/css/interactiveworld.min.css",INTERACTIVEWORLD.DIV_ID="interactive-world",INTERACTIVEWORLD.PATH="http://resources.robotwebtools.org/",INTERACTIVEWORLD.TEXTURE_PATH="/",INTERACTIVEWORLD.IMAGE_PATH="/",INTERACTIVEWORLD.CSS_PATH="/",INTERACTIVEWORLD.init=function(a){a=a||{};var b=a.task,c=document.createElement("link");c.href=INTERACTIVEWORLD.CSS_PATH+INTERACTIVEWORLD.CSS,c.type="text/css",c.rel="stylesheet",c.media="screen,print",document.getElementsByTagName("head")[0].appendChild(c);var d=document.createElement("div");d.id=INTERACTIVEWORLD.DIV_ID,document.getElementsByTagName("body")[0].appendChild(d);var e=new INTERACTIVEWORLD.Viewer({divID:INTERACTIVEWORLD.DIV_ID,antialias:!0,task:b});return e},INTERACTIVEWORLD.createObjectByName=function(a){switch(a){case"Bed":return new INTERACTIVEWORLD.Bed;case"Cabinet":return new INTERACTIVEWORLD.Cabinet;case"Coffee Table":return new INTERACTIVEWORLD.CoffeeTable;case"Couch":return new INTERACTIVEWORLD.Couch;case"Counter":return new INTERACTIVEWORLD.Counter;case"Cup":return new INTERACTIVEWORLD.Cup;case"Dining Table with Chairs":return new INTERACTIVEWORLD.DiningTable;case"Dresser":return new INTERACTIVEWORLD.Dresser;case"Fork":return new INTERACTIVEWORLD.Fork;case"Magazines":return new INTERACTIVEWORLD.Magazines;case"Nightstand":return new INTERACTIVEWORLD.Nightstand;case"Oven":return new INTERACTIVEWORLD.Oven;case"Plate":return new INTERACTIVEWORLD.Plate;case"Refrigerator":return new INTERACTIVEWORLD.Refrigerator;case"Sink Unit":return new INTERACTIVEWORLD.Sink;case"Spoon":return new INTERACTIVEWORLD.Spoon;case"TV":return new INTERACTIVEWORLD.TV;default:var b=INTERACTIVEWORLD.DOT_RADIUS;return new THREE.Mesh(new THREE.SphereGeometry(b,b/1e4,b/1e4),new THREE.MeshNormalMaterial)}},INTERACTIVEWORLD.Model=function(a){var b=this;a=a||{},THREE.Object3D.call(this),this.eventHandler=new INTERACTIVEWORLD.InteractionHandler,this.name=a.name,this.width=a.width,this.depth=a.depth,this.interactions=[],this.pois=[],this.poiFrames=[];var c=INTERACTIVEWORLD.PATH+a.model,d=a.offsetX||0,e=a.offsetY||0,f=a.offsetZ||0,g=a.rotation||0,h=a.scale||1,i=new THREE.ColladaLoader;i.load(c,function(a){a.scene.position.x=d,a.scene.position.y=e,a.scene.position.z=f,a.scene.rotation.z=g,a.scene.scale.x*=h,a.scene.scale.y*=h,a.scene.scale.z*=h,b.add(a.scene)})},INTERACTIVEWORLD.Model.prototype.__proto__=THREE.Object3D.prototype,INTERACTIVEWORLD.Model.prototype.addInteractionSurface=function(a,b,c,d,e){var f=this,g="surface"+this.interactions.length,h=new INTERACTIVEWORLD.InteractionSurface({width:a,height:b,offsetX:d,offsetY:e,offsetZ:c,name:g});h.eventHandler.on("addition",function(a){f.eventHandler.emit("addition",{name:f.name,position:{x:f.position.x,y:f.position.y,z:f.position.z},rotation:f.rotation.z,surface:a})}),this.add(h),this.interactions.push(h)},INTERACTIVEWORLD.Model.prototype.addPOI=function(a,b,c,d,e,f,g){this.pois.push({name:a,width:b,height:c,position:{x:e,y:f,z:d},rotation:g});var h=.001,i=new THREE.Mesh(new THREE.SphereGeometry(h,h,h),new THREE.MeshNormalMaterial);i.position.x=e,i.position.y=f,i.position.z=d,i.rotation.z=g,this.add(i),this.poiFrames.push(i)},INTERACTIVEWORLD.Model.prototype.getConfig=function(){return{name:this.name,width:this.width,height:this.depth,position:{x:this.position.x,y:this.position.y,z:this.position.z},rotation:this.rotation.z,poi:this.pois}},INTERACTIVEWORLD.InteractionHandler=function(){},INTERACTIVEWORLD.InteractionHandler.prototype.__proto__=EventEmitter2.prototype,INTERACTIVEWORLD.InteractionSurface=function(a){a=a||{},this.width=a.width,this.height=a.height;var b=a.offsetX||0,c=a.offsetY||0,d=a.offsetZ||0;this.displayObject=null,this.eventHandler=new INTERACTIVEWORLD.InteractionHandler;var e=new THREE.CubeGeometry(this.width,this.height,INTERACTIVEWORLD.INTERACTION_SURFACE_THICKNESS),f=new THREE.MeshLambertMaterial({transparent:!0,color:65280});f.opacity=0,THREE.Mesh.call(this,e,f),this.position.x=b,this.position.y=c,this.position.z=INTERACTIVEWORLD.INTERACTION_SURFACE_THICKNESS+d,this.name=a.name||"surface"},INTERACTIVEWORLD.InteractionSurface.prototype.__proto__=THREE.Mesh.prototype,INTERACTIVEWORLD.InteractionSurface.prototype.mousemove=function(a,b){this.material.opacity=.5,this.parent.updateMatrixWorld();var c=new THREE.Vector3;c.getPositionFromMatrix(this.matrixWorld),null===this.displayObject&&(this.displayObject=a,this.add(this.displayObject)),this.setObjectPose(this.displayObject,b)},INTERACTIVEWORLD.InteractionSurface.prototype.mouseout=function(){this.material.opacity=0,null!==this.displayObject&&(this.remove(this.displayObject),this.displayObject=null)},INTERACTIVEWORLD.InteractionSurface.prototype.dblclick=function(a,b){if(null!==a){var c=this,d=new a;this.setObjectPose(d,b),this.eventHandler.emit("addition",{name:this.name,position:{x:c.position.x,y:c.position.y,z:c.position.z},rotation:c.rotation.z,object:{name:d.name,position:{x:d.position.x,y:d.position.y,z:d.position.z},rotation:d.rotation.z}}),this.add(d)}},INTERACTIVEWORLD.InteractionSurface.prototype.setObjectPose=function(a,b){if(void 0!==a&&null!==a){this.parent.updateMatrixWorld();var c=new THREE.Vector3;if(c.getPositionFromMatrix(this.matrixWorld),a.position=b.sub(c),this.parent.rotation.z===Math.PI||this.parent.rotation.z===-Math.PI)a.position.x*=-1,a.position.y*=-1;else if(this.parent.rotation.z===Math.PI/2){var d=-a.position.x;a.position.x=a.position.y,a.position.y=d}else if(this.parent.rotation.z===-Math.PI/2){var e=a.position.x;a.position.x=-a.position.y,a.position.y=e}a.rotation.z=Math.abs(a.position.x)/this.width>Math.abs(a.position.y)/this.height?a.position.x>0?Math.PI/2:-Math.PI/2:a.position.y>0?Math.PI:0}},INTERACTIVEWORLD.MouseControls=function(a){function b(a){switch(a.preventDefault(),a.button){case 0:q=p.PAN,n.set(a.clientX,a.clientY);break;case 2:q=p.ROTATE,m.set(a.clientX,a.clientY)}h.domElement.addEventListener("mousemove",c,!1),h.domElement.addEventListener("mouseup",d,!1)}function c(a){a.preventDefault();var b=a.movementX||a.mozMovementX||a.webkitMovementX||0,c=a.movementY||a.mozMovementY||a.webkitMovementY||0;switch(q){case p.ROTATE:l.position.x=l.position.x,l.position.y=l.position.y,l.rotation.z-=.002*(b-c);break;case p.PAN:l.translateX(.01*-b),l.translateY(.01*c),l.position.x=Math.min(Math.max(l.position.x,-INTERACTIVEWORLD.HOUSE_WIDTH/2),INTERACTIVEWORLD.HOUSE_WIDTH/2),l.position.y=Math.min(Math.max(l.position.y,-INTERACTIVEWORLD.HOUSE_HEIGHT/2),INTERACTIVEWORLD.HOUSE_HEIGHT/2)}}function d(a){a.preventDefault(),h.domElement.removeEventListener("mousemove",c,!1),h.domElement.removeEventListener("mouseup",d,!1),q=p.NONE}function e(a){a.preventDefault();var b=0;a.wheelDelta?b=a.wheelDelta:a.detail&&(b=-a.detail),b>0?h.dollyOut():h.dollyIn()}function f(a){a.preventDefault();var b=new THREE.Vector3(a.clientX/window.innerWidth*2-1,2*-(a.clientY/window.innerHeight)+1,.5);o.unprojectVector(b,h.camera),h.camera.updateMatrixWorld();var c=new THREE.Vector3;c.getPositionFromMatrix(h.camera.matrixWorld);for(var d=new THREE.Raycaster(c,b.sub(c).normalize()),e=d.intersectObjects(h.surfaces),f=0;f<h.surfaces.length;f++)e.length>0&&e[0].object===h.surfaces[f]?h.surfaces[f].mousemove(j[i.counter],e[0].point):h.surfaces[f].mouseout()}function g(a){a.preventDefault();var b=new THREE.Vector3(a.clientX/window.innerWidth*2-1,2*-(a.clientY/window.innerHeight)+1,.5);o.unprojectVector(b,h.camera),h.camera.updateMatrixWorld();var c=new THREE.Vector3;c.getPositionFromMatrix(h.camera.matrixWorld);var d=new THREE.Raycaster(c,b.sub(c).normalize()),e=d.intersectObjects(h.surfaces);e.length>0&&(e[0].object.dblclick(i.getDisplayObjectType(),e[0].point),i.markPlacedItem())}var h=this;a=a||{},this.camera=a.camera,this.scene=a.scene,this.domElement=a.domElement;var i=a.objectMenu;this.surfaces=[];for(var j=[],k=0;k<i.objects.length;k++)j.push(new i.objects[k].constructor);this.camera.position.z=4*INTERACTIVEWORLD.WALL_HEIGHT;var l=new THREE.Object3D;l.add(this.camera),this.scene.add(l),l.position.z=3*INTERACTIVEWORLD.WALL_HEIGHT,this.target=new THREE.Vector3,this.EPS=1e-6,this.phiDelta=0,this.thetaDelta=0,this.scale=1,this.pan=new THREE.Vector3,this.zoomSpeed=1,this.autoRotateSpeed=2;var m=new THREE.Vector2,n=new THREE.Vector2;this.lastPosition=new THREE.Vector3;var o=new THREE.Projector,p={NONE:-1,ROTATE:0,DOLLY:1,PAN:2},q=p.NONE;this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1),this.domElement.addEventListener("mousedown",b,!1),this.domElement.addEventListener("mousewheel",e,!1),this.domElement.addEventListener("DOMMouseScroll",e,!1),this.domElement.addEventListener("mousemove",f,!1),this.domElement.addEventListener("dblclick",g,!1),this.rotateUp(-.75)},INTERACTIVEWORLD.MouseControls.prototype.__proto__=THREE.EventDispatcher.prototype,INTERACTIVEWORLD.MouseControls.prototype.update=function(){var a=this.camera.position,b=a.clone().sub(this.target),c=Math.atan2(Math.sqrt(b.x*b.x+b.z*b.z),b.y)+this.phiDelta;c=Math.max(0,Math.min(Math.PI,c)),c=Math.max(this.EPS,Math.min(Math.PI-this.EPS,c));var d=b.length()*this.scale;4>d&&d>.5&&(b.y=d*Math.cos(c),b.z=d*Math.sin(c),a.copy(this.target).add(b),this.camera.lookAt(this.target)),this.phiDelta=0,this.scale=1},INTERACTIVEWORLD.MouseControls.prototype.rotateUp=function(a){void 0===a&&(a=2*Math.PI/60/60*this.autoRotateSpeed),this.phiDelta-=a},INTERACTIVEWORLD.MouseControls.prototype.dollyIn=function(a){void 0===a&&(a=Math.pow(.95,this.zoomSpeed)),this.scale/=a,this.rotateUp(.01)},INTERACTIVEWORLD.MouseControls.prototype.dollyOut=function(a){void 0===a&&(a=Math.pow(.95,this.zoomSpeed)),this.scale*=a,this.rotateUp(-.01)},INTERACTIVEWORLD.MouseControls.prototype.addInteractionSurfaces=function(a){for(var b=0;b<a.length;b++)this.surfaces.push(a[b])},INTERACTIVEWORLD.ObjectMenu=function(a){function b(){f.counter--,f.counter<0&&(f.counter=f.objects.length-1),l.remove(f.displayObject),f.displayObject=f.objects[f.counter],l.add(f.displayObject),q.innerHTML="&nbsp;&nbsp;&nbsp;"+f.displayObject.name+"&nbsp;&nbsp;&nbsp;"}function c(){f.counter++,f.counter>=f.objects.length&&(f.counter=0),l.remove(f.displayObject),f.displayObject=f.objects[f.counter],l.add(f.displayObject),q.innerHTML="&nbsp;&nbsp;&nbsp;"+f.displayObject.name+"&nbsp;&nbsp;&nbsp;"}function d(){var a=f.getMenuWidth(),b=f.getMenuHeight();i.style.width=a+"px",i.style.height=b+"px",i.style.top=window.innerHeight-b+"px",j.style.fontSize=Math.round(f.getMenuWidth()/20)+"px",p.style.height=Math.round(f.getMenuWidth()/12)+"px",r.style.height=Math.round(f.getMenuWidth()/12)+"px",o.style.height=Math.round(f.getMenuWidth()/12)+"px",k.setSize(a,b-j.offsetHeight-o.offsetHeight),m.aspect=a/(b-j.offsetHeight-o.offsetHeight)}function e(){f.displayObject.rotation.z+=.005,k.render(l,m),requestAnimationFrame(e)}var f=this;a=a||{};var g=a.antialias;this.objects=a.objects,this.counter=0,this.displayObject=this.objects[this.counter],this.placedObjects=[],this.placedObjectCount=[];var h=a.title||"";if(this.completion=a.completion||1,0!==this.objects.length){var i=document.createElement("div");i.classList.add("object-menu"),document.getElementsByTagName("body")[0].appendChild(i);var j=document.createElement("h1");j.innerHTML=h,i.appendChild(j);var k=new THREE.WebGLRenderer({antialias:g}),l=new THREE.Scene;l.add(this.displayObject);var m=new THREE.PerspectiveCamera(60,2.5,.01,1e3);m.position.y=-.25,m.position.z=.25,m.lookAt(l.position);var n=new THREE.Mesh(new THREE.CubeGeometry(INTERACTIVEWORLD.OBJECT_MENU_DISPLAY_WIDTH,INTERACTIVEWORLD.OBJECT_MENU_DISPLAY_HEIGHT,.01),new THREE.MeshLambertMaterial({transparent:!0,color:255}));n.material.opacity=.5,n.position.z=-.01,l.add(n),l.add(new THREE.AmbientLight(6710886)),l.add(new THREE.HemisphereLight(16777215,11184810,.8)),i.appendChild(k.domElement);var o=document.createElement("div"),p=document.createElement("img");p.src=INTERACTIVEWORLD.IMAGE_PATH+INTERACTIVEWORLD.PREVIOUS_ARROW,p.onclick=b,p.style.cursor="pointer",o.appendChild(p);var q=document.createElement("span");o.appendChild(q),q.innerHTML="&nbsp;&nbsp;&nbsp;"+this.displayObject.name+"&nbsp;&nbsp;&nbsp;";var r=document.createElement("img");r.src=INTERACTIVEWORLD.IMAGE_PATH+INTERACTIVEWORLD.NEXT_ARROW,r.onclick=c,r.style.cursor="pointer",o.appendChild(r),i.appendChild(o),window.addEventListener("resize",d,!1),d(),e()}},INTERACTIVEWORLD.ObjectMenu.prototype.__proto__=EventEmitter2.prototype,INTERACTIVEWORLD.ObjectMenu.prototype.getMenuWidth=function(){return window.innerWidth/4},INTERACTIVEWORLD.ObjectMenu.prototype.getMenuHeight=function(){return.5*this.getMenuWidth()},INTERACTIVEWORLD.ObjectMenu.prototype.getDisplayObjectType=function(){return void 0===this.displayObject?null:this.displayObject.constructor},INTERACTIVEWORLD.ObjectMenu.prototype.markPlacedItem=function(){var a=this.objects.indexOf(this.displayObject);if(-1===this.placedObjects.indexOf(a)?(this.placedObjects.push(a),this.placedObjectCount.push(1)):this.placedObjectCount[this.placedObjects.indexOf(a)]++,this.placedObjects.length===this.objects.length){for(var b=0;b<this.objects.length;b++)if(this.placedObjectCount[b]<this.completion)return;this.emit("completion")}},INTERACTIVEWORLD.Bed=function(){INTERACTIVEWORLD.Model.call(this,{name:"Bed",width:1.7,depth:2.15,model:INTERACTIVEWORLD.BED_MODEL,offsetX:-.875,offsetY:1.1,rotation:-Math.PI/2}),this.addInteractionSurface(this.width-.1,this.depth,.658,0,0);var a="pillow",b=.64,c=.35,d=.84,e=.35,f=.76,g=0;this.addPOI(a,b,c,d,e,f,g),this.addPOI(a,b,c,d,-e,f,g)},INTERACTIVEWORLD.Bed.prototype.__proto__=INTERACTIVEWORLD.Model.prototype,INTERACTIVEWORLD.Cabinet=function(){INTERACTIVEWORLD.Model.call(this,{name:"Cabinet",width:1.91,depth:.557,model:INTERACTIVEWORLD.CABINET_MODEL,offsetX:-.916,offsetY:-.126})},INTERACTIVEWORLD.Cabinet.prototype.__proto__=INTERACTIVEWORLD.Model.prototype,INTERACTIVEWORLD.CoffeeTable=function(){INTERACTIVEWORLD.Model.call(this,{name:"Coffee Table",width:1.54,depth:.84,model:INTERACTIVEWORLD.COFFEE_TABLE_MODEL,offsetX:-.773,offsetY:.345,rotation:-Math.PI/2,scale:.11}),this.addInteractionSurface(this.width-.08,this.depth,.408,0,0)},INTERACTIVEWORLD.CoffeeTable.prototype.__proto__=INTERACTIVEWORLD.Model.prototype,INTERACTIVEWORLD.Couch=function(){INTERACTIVEWORLD.Model.call(this,{name:"Couch",width:2.99,depth:1.68,model:INTERACTIVEWORLD.COUCH_MODEL,offsetX:-2.18,offsetY:-.33});var a=.99,b=.348;this.addInteractionSurface(a,this.depth,b,-1,0,0),this.addInteractionSurface(this.width-a,a,b,.49,.35)},INTERACTIVEWORLD.Couch.prototype.__proto__=INTERACTIVEWORLD.Model.prototype,INTERACTIVEWORLD.Counter=function(){INTERACTIVEWORLD.Model.call(this,{name:"Counter",width:1.08,depth:.82,model:INTERACTIVEWORLD.COUNTER_MODEL,offsetX:1.114,offsetY:1.52,scale:.85}),this.addInteractionSurface(this.width,this.depth,.77,0,0)},INTERACTIVEWORLD.Counter.prototype.__proto__=INTERACTIVEWORLD.Model.prototype,INTERACTIVEWORLD.Cup=function(){INTERACTIVEWORLD.Model.call(this,{name:"Cup",width:.061,depth:.061,model:INTERACTIVEWORLD.CUP_MODEL,rotation:Math.PI,scale:.04})},INTERACTIVEWORLD.Cup.prototype.__proto__=INTERACTIVEWORLD.Model.prototype,INTERACTIVEWORLD.DiningTable=function(){INTERACTIVEWORLD.Model.call(this,{name:"Dining Table with Chairs",width:2.39,depth:1.19,model:INTERACTIVEWORLD.DINING_TABLE_MODEL,offsetX:.965,offsetY:.89}),this.addInteractionSurface(this.width,this.depth,.7,0,0);var a="chair",b=.29,c=.44,d=1.27,e=.03;this.addPOI(a,b,b,c,d,e,-Math.PI/2),this.addPOI(a,b,b,c,-d,2*e,Math.PI/2);var f=.8,g=.68;this.addPOI(a,b,b,c,f,g,0),this.addPOI(a,b,b,c,f,-g,Math.PI),this.addPOI(a,b,b,c,-f,g,0),this.addPOI(a,b,b,c,-f,-g,Math.PI);var h=.03;this.addPOI(a,b,b,c,h,g,0),this.addPOI(a,b,b,c,h,-g,Math.PI)},INTERACTIVEWORLD.DiningTable.prototype.__proto__=INTERACTIVEWORLD.Model.prototype,INTERACTIVEWORLD.Dresser=function(){INTERACTIVEWORLD.Model.call(this,{name:"Dresser",width:1.353,depth:.48,model:INTERACTIVEWORLD.DRESSER_MODEL,offsetX:-17.985,offsetY:-11.785}),this.addInteractionSurface(this.width,this.depth,.8,0,0)},INTERACTIVEWORLD.Dresser.prototype.__proto__=INTERACTIVEWORLD.Model.prototype,INTERACTIVEWORLD.Fork=function(){INTERACTIVEWORLD.Model.call(this,{name:"Fork",width:.025,depth:.195,model:INTERACTIVEWORLD.FORK_MODEL,offsetX:-.0155,offsetY:.0415,rotation:Math.PI/2,scale:.95})},INTERACTIVEWORLD.Fork.prototype.__proto__=INTERACTIVEWORLD.Model.prototype,INTERACTIVEWORLD.Magazines=function(){INTERACTIVEWORLD.Model.call(this,{name:"Magazines",width:.467,depth:.399,model:INTERACTIVEWORLD.MAGAZINES_MODEL,offsetX:-.097,offsetY:-.138,scale:.4})},INTERACTIVEWORLD.Magazines.prototype.__proto__=INTERACTIVEWORLD.Model.prototype,INTERACTIVEWORLD.Nightstand=function(){INTERACTIVEWORLD.Model.call(this,{name:"Nightstand",width:.875,depth:.62,model:INTERACTIVEWORLD.NIGHTSTAND_MODEL,offsetX:-1.359,offsetY:-1,offsetZ:-.1}),this.addInteractionSurface(this.width,this.depth,.72,0,0)},INTERACTIVEWORLD.Nightstand.prototype.__proto__=INTERACTIVEWORLD.Model.prototype,INTERACTIVEWORLD.Oven=function(){INTERACTIVEWORLD.Model.call(this,{name:"Oven",width:1.215,depth:.66,model:INTERACTIVEWORLD.OVEN_MODEL,offsetX:-1.066,offsetY:-.49});var a=.95;this.addInteractionSurface(this.width,this.depth,a);var b="burner",c=.25,d=.135,e=-.175,f=.443,g=0;this.addPOI(b,c,c,a,f,d,g),this.addPOI(b,c,c,a,f,e,g);var h=.15;this.addPOI(b,c,c,a,h,d,g),this.addPOI(b,c,c,a,h,e,g),this.addPOI(b,c,c,a,-f,d,g),this.addPOI(b,c,c,a,-f,e,g)},INTERACTIVEWORLD.Oven.prototype.__proto__=INTERACTIVEWORLD.Model.prototype,INTERACTIVEWORLD.Plate=function(){INTERACTIVEWORLD.Model.call(this,{name:"Plate",width:.149,depth:.149,model:INTERACTIVEWORLD.PLATE_MODEL,offsetX:-.0968,offsetY:-.08,scale:.04})},INTERACTIVEWORLD.Plate.prototype.__proto__=INTERACTIVEWORLD.Model.prototype,INTERACTIVEWORLD.Refrigerator=function(){INTERACTIVEWORLD.Model.call(this,{name:"Refrigerator",width:.883,depth:.8,model:INTERACTIVEWORLD.REFRIGERATOR_MODEL,offsetX:-.592,offsetY:.8,rotation:-Math.PI/2})},INTERACTIVEWORLD.Refrigerator.prototype.__proto__=INTERACTIVEWORLD.Model.prototype,INTERACTIVEWORLD.Sink=function(){INTERACTIVEWORLD.Model.call(this,{name:"Sink Unit",width:2.91,depth:.775,model:INTERACTIVEWORLD.SINK_MODEL,offsetX:-1.763,offsetY:-.645});var a=.91;this.addInteractionSurface(1.51,this.depth,a,-.7,0),this.addInteractionSurface(.54,this.depth,a,1.19,0);var b=.82,c=.46,d=.49,e=-.12;this.addInteractionSurface(b,c,.81,d,e);var f=0;this.addPOI("sink",b,c,a,d,e,f)},INTERACTIVEWORLD.Sink.prototype.__proto__=INTERACTIVEWORLD.Model.prototype,INTERACTIVEWORLD.Spoon=function(){INTERACTIVEWORLD.Model.call(this,{name:"Spoon",width:.032,depth:.15,model:INTERACTIVEWORLD.SPOON_MODEL,offsetX:.0165,offsetY:-.075,rotation:Math.PI/2})},INTERACTIVEWORLD.Spoon.prototype.__proto__=INTERACTIVEWORLD.Model.prototype,INTERACTIVEWORLD.TV=function(){INTERACTIVEWORLD.Model.call(this,{name:"TV",width:2.14,depth:.64,model:INTERACTIVEWORLD.TV_MODEL,offsetX:.295,offsetY:.27,scale:.66});var a=.63;this.addInteractionSurface(this.width,this.depth,a,0,0);var b="speaker",c=.19,d=.89,e=0;this.addPOI(b,c,c,a,d,0,e),this.addPOI(b,c,c,a,-d,0,e),this.addPOI("tv",1.4,.45,a,0,-.03,e)},INTERACTIVEWORLD.TV.prototype.__proto__=INTERACTIVEWORLD.Model.prototype,INTERACTIVEWORLD.TexturePlane=function(a){a=a||{};var b=a.width,c=a.height,d=INTERACTIVEWORLD.TEXTURE_PATH+a.texture,e=a.repeat;this.name="Plane";var f=new THREE.ImageUtils.loadTexture(d);f.wrapS=f.wrapT=THREE.RepeatWrapping,f.repeat.set(e,e),THREE.Mesh.call(this,new THREE.PlaneGeometry(b,c),new THREE.MeshLambertMaterial({map:f}))},INTERACTIVEWORLD.TexturePlane.prototype.__proto__=THREE.Mesh.prototype,INTERACTIVEWORLD.Wall=function(a){a=a||{};var b=a.length,c=INTERACTIVEWORLD.TEXTURE_PATH+a.texture;this.name="Wall";var d=new THREE.ImageUtils.loadTexture(c);d.wrapS=d.wrapT=THREE.RepeatWrapping,d.repeat.set(b,1),THREE.Mesh.call(this,new THREE.CubeGeometry(b,INTERACTIVEWORLD.WALL_WIDTH,INTERACTIVEWORLD.WALL_HEIGHT),new THREE.MeshLambertMaterial({map:d,side:THREE.DoubleSide})),this.position.z=INTERACTIVEWORLD.WALL_HEIGHT/2},INTERACTIVEWORLD.Wall.prototype.__proto__=THREE.Mesh.prototype,INTERACTIVEWORLD.Bedroom=function(a){var b=this;a=a||[],THREE.Object3D.call(this),this.furniture=[],this.name="Bedroom",this.eventHandler=new INTERACTIVEWORLD.InteractionHandler;var c=a.controls,d=a.setup||Math.floor(3*Math.random());this.add(new INTERACTIVEWORLD.Room({width:INTERACTIVEWORLD.ROOM_WIDTH,height:INTERACTIVEWORLD.ROOM_HEIGHT,floor:INTERACTIVEWORLD.BEDROOM_FLOOR_TEXTURE,wall:INTERACTIVEWORLD.BEDROOM_WALL_TEXTURE,withDoor:!0,doorWall:INTERACTIVEWORLD.EAST_WALL,doorSide:INTERACTIVEWORLD.NEGATIVE_DOOR_SIDE}));var e=new INTERACTIVEWORLD.Bed;e.eventHandler.on("addition",function(a){b.eventHandler.emit("addition",{name:b.name,position:{x:b.position.x,y:b.position.y,z:b.position.z},rotation:b.rotation.z,furniture:a})}),this.bed=e;var f=new INTERACTIVEWORLD.Nightstand;f.eventHandler.on("addition",function(a){b.eventHandler.emit("addition",{name:b.name,position:{x:b.position.x,y:b.position.y,z:b.position.z},rotation:b.rotation.z,furniture:a})}),this.nightstandOne=f;var g=new INTERACTIVEWORLD.Nightstand;g.eventHandler.on("addition",function(a){b.eventHandler.emit("addition",{name:b.name,position:{x:b.position.x,y:b.position.y,z:b.position.z},rotation:b.rotation.z,furniture:a})}),this.nightstandTwo=g;var h=new INTERACTIVEWORLD.Dresser;h.eventHandler.on("addition",function(a){b.eventHandler.emit("addition",{name:b.name,position:{x:b.position.x,y:b.position.y,z:b.position.z},rotation:b.rotation.z,furniture:a})}),this.dresser=h;var i=INTERACTIVEWORLD.WALL_WIDTH;0===d?(e.position.y=(INTERACTIVEWORLD.ROOM_HEIGHT-e.depth)/2-i,f.position.x=INTERACTIVEWORLD.ROOM_WIDTH/4+f.width/2-i,f.position.y=(INTERACTIVEWORLD.ROOM_HEIGHT-f.depth)/2-i,g.position.x=-f.position.x,g.position.y=(INTERACTIVEWORLD.ROOM_HEIGHT-g.depth)/2-i,h.position.y=-(INTERACTIVEWORLD.ROOM_HEIGHT-h.depth)/2+i,h.rotation.z=Math.PI):1===d?(e.position.x=-(INTERACTIVEWORLD.ROOM_WIDTH-e.depth)/2+i,e.position.y=.5,e.rotation.z=Math.PI/2,f.position.x=1,f.position.y=-(INTERACTIVEWORLD.ROOM_HEIGHT-f.depth)/2+i,f.rotation.z=Math.PI,g.position.x=(INTERACTIVEWORLD.ROOM_WIDTH-g.depth)/2-i,g.position.y=.5,g.rotation.z=-Math.PI/2,h.position.x=-(INTERACTIVEWORLD.ROOM_WIDTH-h.depth)/2+i,h.position.y=-(INTERACTIVEWORLD.ROOM_HEIGHT-h.width)/2+i,h.rotation.z=Math.PI/2):(e.position.x=-(INTERACTIVEWORLD.ROOM_WIDTH-e.width)/2+i,e.position.y=-(INTERACTIVEWORLD.ROOM_HEIGHT-e.depth)/2+i,e.rotation.z=-Math.PI,f.position.x=1,f.position.y=-(INTERACTIVEWORLD.ROOM_HEIGHT-f.depth)/2+i,f.rotation.z=Math.PI,g.position.x=(INTERACTIVEWORLD.ROOM_WIDTH-g.depth)/2-i,g.position.y=.5,g.rotation.z=-Math.PI/2,h.position.y=(INTERACTIVEWORLD.ROOM_HEIGHT-h.depth)/2-i),this.add(e),this.furniture.push(e),this.add(f),this.furniture.push(f),this.add(g),this.furniture.push(g),this.add(h),this.furniture.push(h),c.addInteractionSurfaces(e.interactions),c.addInteractionSurfaces(f.interactions),c.addInteractionSurfaces(g.interactions),c.addInteractionSurfaces(h.interactions)},INTERACTIVEWORLD.Bedroom.prototype.__proto__=THREE.Object3D.prototype,INTERACTIVEWORLD.Bedroom.prototype.getConfig=function(){for(var a=[],b=0;b<this.furniture.length;b++)a.push(this.furniture[b].getConfig());return{name:this.name,width:INTERACTIVEWORLD.ROOM_WIDTH,height:INTERACTIVEWORLD.ROOM_HEIGHT,position:{x:this.position.x,y:this.position.y,z:this.position.z},rotation:this.rotation.z,furniture:a}},INTERACTIVEWORLD.DiningRoom=function(a){var b=this;a=a||[],THREE.Object3D.call(this),this.furniture=[],this.name="Dining Room",this.eventHandler=new INTERACTIVEWORLD.InteractionHandler;var c=a.controls,d=a.setup||Math.floor(3*Math.random());this.add(new INTERACTIVEWORLD.Room({width:INTERACTIVEWORLD.ROOM_WIDTH,height:INTERACTIVEWORLD.ROOM_HEIGHT,floor:INTERACTIVEWORLD.DINING_ROOM_FLOOR_TEXTURE,wall:INTERACTIVEWORLD.DINING_ROOM_WALL_TEXTURE,withDoor:!0,doorWall:INTERACTIVEWORLD.NORTH_WALL,doorSide:INTERACTIVEWORLD.NEGATIVE_DOOR_SIDE}));var e=new INTERACTIVEWORLD.DiningTable;e.eventHandler.on("addition",function(a){b.eventHandler.emit("addition",{name:b.name,position:{x:b.position.x,y:b.position.y,z:b.position.z},rotation:b.rotation.z,furniture:a})});var f=new INTERACTIVEWORLD.Cabinet,g=new INTERACTIVEWORLD.TexturePlane({width:e.width+1,height:e.depth+1,texture:INTERACTIVEWORLD.RUG_TEXTURE,repeat:1}),h=INTERACTIVEWORLD.WALL_WIDTH;0===d?(f.position.x=-(INTERACTIVEWORLD.ROOM_WIDTH-f.width)/2+h,f.position.y=-(INTERACTIVEWORLD.ROOM_HEIGHT-f.depth)/2+h,f.rotation.z=Math.PI):1===d?(e.position.x=-.75,e.rotation.z=Math.PI/2,f.position.x=(INTERACTIVEWORLD.ROOM_WIDTH-f.width)/2-h,f.position.y=(INTERACTIVEWORLD.ROOM_HEIGHT-f.depth)/2-h):(e.position.x=.75,e.rotation.z=-Math.PI/2,f.position.x=-(INTERACTIVEWORLD.ROOM_WIDTH-f.depth)/2+h,f.rotation.z=Math.PI/2),g.position.x=e.position.x,g.position.y=e.position.y,g.position.z=3*INTERACTIVEWORLD.Z_INDEX,g.rotation.z=e.rotation.z,this.add(e),this.furniture.push(e),this.add(f),this.furniture.push(f),this.add(g),c.addInteractionSurfaces(e.interactions)},INTERACTIVEWORLD.DiningRoom.prototype.__proto__=THREE.Object3D.prototype,INTERACTIVEWORLD.DiningRoom.prototype.getConfig=function(){for(var a=[],b=0;b<this.furniture.length;b++)a.push(this.furniture[b].getConfig());return{name:this.name,width:INTERACTIVEWORLD.ROOM_WIDTH,height:INTERACTIVEWORLD.ROOM_HEIGHT,position:{x:this.position.x,y:this.position.y,z:this.position.z},rotation:this.rotation.z,furniture:a}},INTERACTIVEWORLD.House=function(a){var b=this;a=a||[],THREE.Object3D.call(this);var c=a.controls;this.eventHandler=new INTERACTIVEWORLD.InteractionHandler;var d=new INTERACTIVEWORLD.Room({width:INTERACTIVEWORLD.HOUSE_WIDTH,height:INTERACTIVEWORLD.HOUSE_HEIGHT,floor:INTERACTIVEWORLD.HOUSE_FLOOR_TEXTURE,wall:INTERACTIVEWORLD.HOUSE_WALL_TEXTURE});d.position.z=-INTERACTIVEWORLD.Z_INDEX,this.add(d);var e=INTERACTIVEWORLD.WALL_WIDTH/2,f=new INTERACTIVEWORLD.Bedroom({controls:c});f.position.x=-(INTERACTIVEWORLD.ROOM_WIDTH/2)-(INTERACTIVEWORLD.HOUSE_WIDTH/2-INTERACTIVEWORLD.ROOM_WIDTH)+e,f.position.y=INTERACTIVEWORLD.ROOM_HEIGHT/2+(INTERACTIVEWORLD.HOUSE_HEIGHT/2-INTERACTIVEWORLD.ROOM_HEIGHT)-e,f.eventHandler.on("addition",function(a){b.eventHandler.emit("addition",a)}),this.add(f),this.bedroom=f;var g=new INTERACTIVEWORLD.Kitchen({controls:c});g.eventHandler.on("addition",function(a){b.eventHandler.emit("addition",a)}),g.position.x=INTERACTIVEWORLD.ROOM_WIDTH/2+(INTERACTIVEWORLD.HOUSE_WIDTH/2-INTERACTIVEWORLD.ROOM_WIDTH)-e,g.position.y=INTERACTIVEWORLD.ROOM_HEIGHT/2+(INTERACTIVEWORLD.HOUSE_HEIGHT/2-INTERACTIVEWORLD.ROOM_HEIGHT)-e,this.add(g),this.kitchen=g;var h=new INTERACTIVEWORLD.LivingRoom({controls:c});h.eventHandler.on("addition",function(a){b.eventHandler.emit("addition",a)}),h.position.x=-(INTERACTIVEWORLD.ROOM_WIDTH/2)-(INTERACTIVEWORLD.HOUSE_WIDTH/2-INTERACTIVEWORLD.ROOM_WIDTH)+e,h.position.y=-(INTERACTIVEWORLD.ROOM_HEIGHT/2)-(INTERACTIVEWORLD.HOUSE_HEIGHT/2-INTERACTIVEWORLD.ROOM_HEIGHT)+e,this.add(h),this.livingRoom=h;var i=new INTERACTIVEWORLD.DiningRoom({controls:c});i.eventHandler.on("addition",function(a){b.eventHandler.emit("addition",a)}),i.position.x=INTERACTIVEWORLD.ROOM_WIDTH/2+(INTERACTIVEWORLD.HOUSE_WIDTH/2-INTERACTIVEWORLD.ROOM_WIDTH)-e,i.position.y=-(INTERACTIVEWORLD.ROOM_HEIGHT/2)-(INTERACTIVEWORLD.HOUSE_HEIGHT/2-INTERACTIVEWORLD.ROOM_HEIGHT)+e,this.add(i),this.diningRoom=i,this.config={rooms:[f.getConfig(),g.getConfig(),h.getConfig(),i.getConfig()]},this.rooms=[f,g,h,i]},INTERACTIVEWORLD.House.prototype.__proto__=THREE.Object3D.prototype,INTERACTIVEWORLD.Kitchen=function(a){var b=this;a=a||[],THREE.Object3D.call(this),this.furniture=[],this.name="Kitchen",this.eventHandler=new INTERACTIVEWORLD.InteractionHandler;
var c=a.controls,d=a.setup||Math.floor(3*Math.random());this.add(new INTERACTIVEWORLD.Room({width:INTERACTIVEWORLD.ROOM_WIDTH,height:INTERACTIVEWORLD.ROOM_HEIGHT,floor:INTERACTIVEWORLD.KITCHEN_FLOOR_TEXTURE,wall:INTERACTIVEWORLD.KITCHEN_WALL_TEXTURE,withDoor:!0,doorWall:INTERACTIVEWORLD.SOUTH_WALL,doorSide:INTERACTIVEWORLD.NEGATIVE_DOOR_SIDE}));var e=new INTERACTIVEWORLD.Refrigerator,f=new INTERACTIVEWORLD.Sink;f.eventHandler.on("addition",function(a){b.eventHandler.emit("addition",{name:b.name,position:{x:b.position.x,y:b.position.y,z:b.position.z},rotation:b.rotation.z,furniture:a})});var g=new INTERACTIVEWORLD.Oven;g.eventHandler.on("addition",function(a){b.eventHandler.emit("addition",{name:b.name,position:{x:b.position.x,y:b.position.y,z:b.position.z},rotation:b.rotation.z,furniture:a})});var h=new INTERACTIVEWORLD.Counter;h.eventHandler.on("addition",function(a){b.eventHandler.emit("addition",{name:b.name,position:{x:b.position.x,y:b.position.y,z:b.position.z},rotation:b.rotation.z,furniture:a})});var i=new INTERACTIVEWORLD.Counter;i.eventHandler.on("addition",function(a){b.eventHandler.emit("addition",{name:b.name,position:{x:b.position.x,y:b.position.y,z:b.position.z},rotation:b.rotation.z,furniture:a})});var j=INTERACTIVEWORLD.WALL_WIDTH;0===d?(e.position.x=(INTERACTIVEWORLD.ROOM_WIDTH-e.width)/2-j,e.position.y=(INTERACTIVEWORLD.ROOM_HEIGHT-e.depth)/2-j,f.position.x=-(INTERACTIVEWORLD.ROOM_WIDTH-f.width)/2+j,f.position.y=(INTERACTIVEWORLD.ROOM_HEIGHT-f.depth)/2-j,h.position.x=(INTERACTIVEWORLD.ROOM_WIDTH-h.width)/2-j,h.position.y=-(INTERACTIVEWORLD.ROOM_HEIGHT-h.depth)/2+j,h.rotation.z=Math.PI,g.position.x=(INTERACTIVEWORLD.ROOM_WIDTH-g.width)/2-2*j-h.width,g.position.y=-(INTERACTIVEWORLD.ROOM_HEIGHT-g.depth)/2+j,g.rotation.z=Math.PI,i.position.x=(INTERACTIVEWORLD.ROOM_WIDTH-i.width)/2-3*j-h.width-g.width,i.position.y=h.position.y,i.rotation.z=h.rotation.z):1===d?(e.position.x=(INTERACTIVEWORLD.ROOM_WIDTH-e.width)/2-j,e.position.y=-(INTERACTIVEWORLD.ROOM_HEIGHT-e.depth)/2+j,e.rotation.z=Math.PI,g.position.y=-(INTERACTIVEWORLD.ROOM_HEIGHT-g.depth)/2+j,g.rotation.z=Math.PI,f.position.x=-(INTERACTIVEWORLD.ROOM_WIDTH-f.depth)/2+j,f.position.y=(INTERACTIVEWORLD.ROOM_HEIGHT-f.width)/2-j,f.rotation.z=Math.PI/2,h.position.x=1.3,h.position.y=(INTERACTIVEWORLD.ROOM_HEIGHT-h.depth)/2-j,i.position.x=h.position.x-h.width,i.position.y=h.position.y):(f.position.x=(INTERACTIVEWORLD.ROOM_WIDTH-f.depth)/2-j,f.position.y=-(INTERACTIVEWORLD.ROOM_HEIGHT-f.width)/2+j,f.rotation.z=-Math.PI/2,e.position.x=(INTERACTIVEWORLD.ROOM_WIDTH-e.depth)/2-j,e.position.y=(INTERACTIVEWORLD.ROOM_HEIGHT-e.width)/2-j,e.rotation.z=-Math.PI/2,h.position.x=-(INTERACTIVEWORLD.ROOM_WIDTH-h.depth)/2+j,h.position.y=(INTERACTIVEWORLD.ROOM_HEIGHT-h.width)/2-j,h.rotation.z=Math.PI/2,i.position.x=h.position.x,i.position.y=h.position.y-h.width,i.rotation.z=h.rotation.z,g.position.x=-.5,g.position.y=-(INTERACTIVEWORLD.ROOM_HEIGHT-g.depth)/2+j,g.rotation.z=Math.PI),this.add(e),this.furniture.push(e),this.add(f),this.furniture.push(f),this.add(g),this.furniture.push(g),this.add(h),this.furniture.push(h),this.add(i),this.furniture.push(i),c.addInteractionSurfaces(f.interactions),c.addInteractionSurfaces(h.interactions),c.addInteractionSurfaces(i.interactions),c.addInteractionSurfaces(g.interactions)},INTERACTIVEWORLD.Kitchen.prototype.__proto__=THREE.Object3D.prototype,INTERACTIVEWORLD.Kitchen.prototype.getConfig=function(){for(var a=[],b=0;b<this.furniture.length;b++)a.push(this.furniture[b].getConfig());return{name:this.name,width:INTERACTIVEWORLD.ROOM_WIDTH,height:INTERACTIVEWORLD.ROOM_HEIGHT,position:{x:this.position.x,y:this.position.y,z:this.position.z},rotation:this.rotation.z,furniture:a}},INTERACTIVEWORLD.LivingRoom=function(a){var b=this;a=a||[],THREE.Object3D.call(this),this.furniture=[],this.name="Living Room",this.eventHandler=new INTERACTIVEWORLD.InteractionHandler;{var c=a.controls;a.setup||Math.floor(3*Math.random())}this.add(new INTERACTIVEWORLD.Room({width:INTERACTIVEWORLD.ROOM_WIDTH,height:INTERACTIVEWORLD.ROOM_HEIGHT,floor:INTERACTIVEWORLD.LIVING_ROOM_FLOOR_TEXTURE,wall:INTERACTIVEWORLD.LIVING_ROOM_WALL_TEXTURE,withDoor:!0,doorWall:INTERACTIVEWORLD.EAST_WALL,doorSide:INTERACTIVEWORLD.POSITIVE_DOOR_SIDE}));var d=new INTERACTIVEWORLD.Couch;d.eventHandler.on("addition",function(a){b.eventHandler.emit("addition",{name:b.name,position:{x:b.position.x,y:b.position.y,z:b.position.z},rotation:b.rotation.z,furniture:a})});var e=new INTERACTIVEWORLD.TV;e.eventHandler.on("addition",function(a){b.eventHandler.emit("addition",{name:b.name,position:{x:b.position.x,y:b.position.y,z:b.position.z},rotation:b.rotation.z,furniture:a})});var f=new INTERACTIVEWORLD.CoffeeTable;f.eventHandler.on("addition",function(a){b.eventHandler.emit("addition",{name:b.name,position:{x:b.position.x,y:b.position.y,z:b.position.z},rotation:b.rotation.z,furniture:a})});var g=INTERACTIVEWORLD.WALL_WIDTH;d.position.x=-(INTERACTIVEWORLD.ROOM_WIDTH-d.width)/2+g,d.position.y=(INTERACTIVEWORLD.ROOM_HEIGHT-d.depth)/2-g,e.position.x=(INTERACTIVEWORLD.ROOM_WIDTH-e.depth)/2-g,e.position.y=-(INTERACTIVEWORLD.ROOM_HEIGHT-e.width)/2+g,e.rotation.z=-Math.PI/2,this.add(d),this.furniture.push(d),this.add(e),this.furniture.push(e),this.add(f),this.furniture.push(f),c.addInteractionSurfaces(f.interactions),c.addInteractionSurfaces(d.interactions),c.addInteractionSurfaces(e.interactions)},INTERACTIVEWORLD.LivingRoom.prototype.__proto__=THREE.Object3D.prototype,INTERACTIVEWORLD.LivingRoom.prototype.getConfig=function(){for(var a=[],b=0;b<this.furniture.length;b++)a.push(this.furniture[b].getConfig());return{name:this.name,width:INTERACTIVEWORLD.ROOM_WIDTH,height:INTERACTIVEWORLD.ROOM_HEIGHT,position:{x:this.position.x,y:this.position.y,z:this.position.z},rotation:this.rotation.z,furniture:a}},INTERACTIVEWORLD.Room=function(a){THREE.Object3D.call(this),a=a||{};var b=a.width,c=a.height,d=a.withDoor,e=a.doorWall,f=a.doorSide,g=a.floor,h=a.wall;this.add(new INTERACTIVEWORLD.TexturePlane({width:b,height:c,texture:g,repeat:4}));var i=new INTERACTIVEWORLD.Wall({length:b,texture:h});i.position.y=c/2;var j=new INTERACTIVEWORLD.Wall({length:c,texture:h});j.position.x=b/2,j.rotation.z=Math.PI/2;var k=new INTERACTIVEWORLD.Wall({length:b,texture:h});k.position.y=-c/2;var l=new INTERACTIVEWORLD.Wall({length:c,texture:h});l.position.x=-b/2,l.rotation.z=Math.PI/2,d&&(e===INTERACTIVEWORLD.NORTH_WALL?(i=new INTERACTIVEWORLD.Wall({length:b-INTERACTIVEWORLD.DOOR_WIDTH,texture:h}),i.position.y=c/2,i.position.x=f===INTERACTIVEWORLD.NEGATIVE_DOOR_SIDE?INTERACTIVEWORLD.DOOR_WIDTH/2:-INTERACTIVEWORLD.DOOR_WIDTH/2):e===INTERACTIVEWORLD.EAST_WALL?(j=new INTERACTIVEWORLD.Wall({length:c-INTERACTIVEWORLD.DOOR_WIDTH,texture:h}),j.position.x=b/2,j.rotation.z=Math.PI/2,j.position.y=f===INTERACTIVEWORLD.NEGATIVE_DOOR_SIDE?INTERACTIVEWORLD.DOOR_WIDTH/2:-INTERACTIVEWORLD.DOOR_WIDTH/2):e===INTERACTIVEWORLD.SOUTH_WALL?(k=new INTERACTIVEWORLD.Wall({length:b-INTERACTIVEWORLD.DOOR_WIDTH,texture:h}),k.position.y=-c/2,k.position.x=f===INTERACTIVEWORLD.NEGATIVE_DOOR_SIDE?INTERACTIVEWORLD.DOOR_WIDTH/2:-INTERACTIVEWORLD.DOOR_WIDTH/2):(l=new INTERACTIVEWORLD.Wall({length:c-INTERACTIVEWORLD.DOOR_WIDTH,texture:h}),l.position.x=-b/2,l.rotation.z=Math.PI/2,l.position.y=f===INTERACTIVEWORLD.NEGATIVE_DOOR_SIDE?INTERACTIVEWORLD.DOOR_WIDTH/2:-INTERACTIVEWORLD.DOOR_WIDTH/2)),this.add(i),this.add(j),this.add(k),this.add(l)},INTERACTIVEWORLD.Room.prototype.__proto__=THREE.Object3D.prototype,INTERACTIVEWORLD.Viewer=function(a){function b(){n.setSize(window.innerWidth,window.innerHeight)}function c(){q.update(),n.render(o,p),requestAnimationFrame(c)}var d=this;a=a||{};var e=a.divID,f=a.antialias,g=a.task||0;this.manuallyPlacedItems=[];var h=[],i=[],j=0,k="";g===INTERACTIVEWORLD.TASK_TABLE_SETTING?(h=[new INTERACTIVEWORLD.Plate,new INTERACTIVEWORLD.Cup,new INTERACTIVEWORLD.Fork,new INTERACTIVEWORLD.Spoon],j=3,k="Set the table with these objects."):g===INTERACTIVEWORLD.TASK_MAGAZINE_PLACEMENT?(h=[new INTERACTIVEWORLD.Magazines],j=3,k="Place the object where it belongs."):g===INTERACTIVEWORLD.TASK_DIRTY_DISHES?(h=[new INTERACTIVEWORLD.Plate,new INTERACTIVEWORLD.Cup,new INTERACTIVEWORLD.Fork,new INTERACTIVEWORLD.Spoon],j=3,k="Place the dirty dishes where they belong."):g===INTERACTIVEWORLD.TASK_PUT_AWAY_GENERAL&&(h=[new INTERACTIVEWORLD.Plate,new INTERACTIVEWORLD.Cup,new INTERACTIVEWORLD.Fork,new INTERACTIVEWORLD.Spoon,new INTERACTIVEWORLD.Magazines],j=3,k="Put the items away where they belong.");for(var l=0;l<h.length;l++)i.push({name:h[l].name,width:h[l].width,height:h[l].depth});var m=new INTERACTIVEWORLD.ObjectMenu({antialias:f,objects:h,completion:j,title:k});m.on("completion",function(){d.emit("completion")});var n=new THREE.WebGLRenderer({antialias:f}),o=new THREE.Scene,p=new THREE.PerspectiveCamera(60,window.innerWidth/window.innerHeight,.01,1e3);o.add(new THREE.AmbientLight(6710886)),o.add(new THREE.HemisphereLight(16777215,11184810,.8));var q=new INTERACTIVEWORLD.MouseControls({scene:o,camera:p,domElement:n.domElement,objectMenu:m}),r=new INTERACTIVEWORLD.World({controls:q});o.add(r),this.config=r.config,this.config.objects=i,this.config.task=k,r.interactionHandler.on("addition",function(a){d.emit("addition",a)}),this.world=r,window.addEventListener("resize",b,!1),b(),document.getElementById(e).appendChild(n.domElement),c()},INTERACTIVEWORLD.Viewer.prototype.__proto__=EventEmitter2.prototype,INTERACTIVEWORLD.Viewer.prototype.placeObjectOnSurface=function(a){a=a||{};for(var b=a.furnitureName,c=a.surfaceName||"surface",d=a.itemName,e=a.position,f=a.rotation,g=0;g<this.world.house.rooms.length;g++)for(var h=this.world.house.rooms[g],i=0;i<h.furniture.length;i++){var j=h.furniture[i];if(j.name===b)for(var k=0;k<j.interactions.length;k++){var l=j.interactions[k];if(l.name===c){var m=INTERACTIVEWORLD.createObjectByName(d);m.position.x=e.x,m.position.y=e.y,m.position.z=e.z,m.rotation.z=f.z,l.add(m),this.manuallyPlacedItems.push(m)}}}},INTERACTIVEWORLD.Viewer.prototype.placeObjectOnFurniture=function(a){a=a||{};for(var b=a.furnitureName,c=a.itemName,d=a.position,e=a.rotation,f=0;f<this.world.house.rooms.length;f++)for(var g=this.world.house.rooms[f],h=0;h<g.furniture.length;h++){var i=g.furniture[h];if(i.name===b){var j=INTERACTIVEWORLD.createObjectByName(c);j.position.x=d.x,j.position.y=d.y,j.position.z=i.interactions[0].position.z,j.rotation.z=e.z,i.add(j),this.manuallyPlacedItems.push(j)}}},INTERACTIVEWORLD.Viewer.prototype.placeObjectOnPoi=function(a){a=a||{};for(var b=a.furnitureName,c=a.poiName,d=a.itemName,e=a.position,f=a.rotation,g=0;g<this.world.house.rooms.length;g++)for(var h=this.world.house.rooms[g],i=0;i<h.furniture.length;i++){var j=h.furniture[i];if(j.name===b)for(var k=0;k<j.pois.length;k++){var l=j.pois[k];if(l.name===c){var m=INTERACTIVEWORLD.createObjectByName(d);return m.position.x=e.x,m.position.y=e.y,m.position.z=l.height,m.rotation.z=f.z,j.poiFrames[k].add(m),void this.manuallyPlacedItems.push(m)}}}},INTERACTIVEWORLD.Viewer.prototype.placeObjectOnObject=function(a){a=a||{};for(var b=a.referenceItemName,c=a.itemName,d=a.position,e=a.rotation,f=0;f<this.manuallyPlacedItems.length;f++){var g=this.manuallyPlacedItems[f];if(g.name===b){var h=INTERACTIVEWORLD.createObjectByName(c);return h.position.x=d.x,h.position.y=d.y,h.position.z=d.z,h.rotation.z=e.z,g.add(h),void this.manuallyPlacedItems.push(h)}}},INTERACTIVEWORLD.Viewer.prototype.displayTemplateFromModels=function(a){for(var b=[],c=0;c<this.world.house.rooms.length;c++)for(var d=this.world.house.rooms[c],e=0;e<d.furniture.length;e++){var f=d.furniture[e];b.push({name:f.name,type:"furniture"});for(var g=0;g<f.pois.length;g++){for(var h=f.pois[g],i=!0,j=0;j<b.length;j++)if(b[j].name===h.name){i=!1;break}i&&b.push({name:h.name,type:"poi",furniture:f.name})}}for(var k=[],l=0;l<a.length;l++)-1===k.indexOf(a[l].placement.item.name)&&k.push(a[l].placement.item.name);for(;k.length>0;){for(var m=1/0,n={},o=0;o<a.length;o++){var p=a[o];if(k.indexOf(p.placement.item.name)>=0){for(var q=!1,r=0;r<b.length;r++)if(b[r].name===p.placement.reference_frame_id){q=!0;break}q&&p.decision_value<m&&(m=p.decision_value,n=p.placement)}}for(var s=0;s<b.length;s++){var t=b[s];if(t.name===n.reference_frame_id){switch(console.log("Placing "+n.item.name+" w.r.t "+n.reference_frame_id),t.type){case"furniture":this.placeObjectOnFurniture({furnitureName:t.name,itemName:n.item.name,position:n.position,rotation:{z:n.rotation}});break;case"poi":this.placeObjectOnPoi({furnitureName:t.furniture,poiName:t.name,itemName:n.item.name,position:n.position,rotation:{z:n.rotation}});break;case"item":this.placeObjectOnObject({referenceItemName:t.name,itemName:n.item.name,position:n.position,rotation:{z:n.rotation}})}k.splice(k.indexOf(n.item.name),1),b.push({name:n.item.name,type:"item"});break}}}},INTERACTIVEWORLD.World=function(a){a=a||[],THREE.Object3D.call(this);var b=a.controls,c=new INTERACTIVEWORLD.TexturePlane({width:INTERACTIVEWORLD.WORLD_WIDTH,height:INTERACTIVEWORLD.WORLD_HEIGHT,texture:INTERACTIVEWORLD.WORLD_FLOOR_TEXTURE,repeat:10});c.position.z=2*-INTERACTIVEWORLD.Z_INDEX,this.add(c);var d=INTERACTIVEWORLD.TEXTURE_PATH+INTERACTIVEWORLD.SKY_TEXTURE,e=THREE.ImageUtils.loadTextureCube([d,d,d,d,d,d]);e.format=THREE.RGBFormat;var f=THREE.ShaderLib.cube;f.uniforms.tCube.value=e,this.add(new THREE.Mesh(new THREE.CubeGeometry(INTERACTIVEWORLD.WORLD_WIDTH,INTERACTIVEWORLD.WORLD_HEIGHT,Math.max(INTERACTIVEWORLD.WORLD_WIDTH,INTERACTIVEWORLD.WORLD_HEIGHT)),new THREE.ShaderMaterial({fragmentShader:f.fragmentShader,vertexShader:f.vertexShader,uniforms:f.uniforms,side:THREE.BackSide})));var g=new INTERACTIVEWORLD.House({controls:b});this.add(g),this.interactionHandler=g.eventHandler,this.config=g.config,this.house=g},INTERACTIVEWORLD.World.prototype.__proto__=THREE.Object3D.prototype;